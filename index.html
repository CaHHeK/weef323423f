<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Push Notifications</title>
    <style>
        /* Основной стиль для страницы */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f9f9f9;
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        /* Контейнер для кодов */
        #codesContainer {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }

        /* Стиль для кода */
        .code {
            cursor: pointer;
            padding: 10px;
            margin: 10px;
            background-color: #ffffff;
            border: 1px solid #dfe4ea;
            border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            font-size: 16px;
            color: #3c3c3c;
            width: calc(50% - 40px);
            box-sizing: border-box;
            transition: background-color 0.2s;
        }

        .code:hover {
            background-color: #f1f1f1;
        }

        /* Основной стиль для кнопок */
        button {
            background-color: #0088cc;
            color: white;
            padding: 10px 20px;
            margin: 10px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s;
            outline: none;
        }

        button:hover {
            background-color: #0078b6;
        }

        button:active {
            background-color: #006ba1;
        }

        button:focus {
            outline: none;
        }

        /* Стиль для текстовой области */
        textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #dfe4ea;
            border-radius: 12px;
            font-size: 16px;
            box-sizing: border-box;
            resize: none;
            outline: none;
        }

        textarea:focus {
            border-color: #0088cc;
        }
    </style>
</head>
<body>
    <div id="codesContainer"></div>
    <textarea id="newCodesInput" placeholder="Введите новые коды, каждый с новой строки" rows="5" cols="30"></textarea>
    <br>
    <button onclick="addNewCodes()">Добавить коды</button>
    <button onclick="clearCodes()">Очистить коды</button>
    <button onclick="sendNotification()">Тест уведомления</button>
    <br>
    <button onclick="enableNotifications('always')">Включить уведомления (Всегда)</button>
    <button onclick="enableNotifications('1h')">Включить уведомления (1 час)</button>
    <button onclick="enableNotifications('6h')">Включить уведомления (6 часов)</button>
    <button onclick="disableNotifications()">Выключить уведомления</button>

    <script>
        const storageKey = 'savedCodes';
        let codes = [];
        let notificationsEnabled = false;
        let notificationLimit = 6; // Лимит уведомлений за 2 часа
        let sentNotifications = 0; // Счетчик отправленных уведомлений
        let notificationTimeout; // Переменная для хранения таймера уведомлений

        // Регистрация Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/weef323423f/sw.js').then(reg => {
                console.log('Service Worker зарегистрирован:', reg);
            }).catch(err => {
                console.error('Ошибка регистрации Service Worker:', err);
            });
        }

        // Загрузка кодов из localStorage
        function loadCodes() {
            const savedCodes = localStorage.getItem(storageKey);
            if (savedCodes) {
                codes = JSON.parse(savedCodes);
            }
        }

        // Сохранение кодов в localStorage
        function saveCodes() {
            localStorage.setItem(storageKey, JSON.stringify(codes));
        }

        // Отображение кодов на странице
        function renderCodes() {
            const container = document.getElementById('codesContainer');
            container.innerHTML = '';
            codes.forEach((code, index) => {
                const codeDiv = document.createElement('div');
                codeDiv.className = 'code';
                codeDiv.innerText = code;
                codeDiv.onclick = () => handleCodeClick(code, index);
                container.appendChild(codeDiv);
            });
        }

        // Добавление новых кодов
        function addNewCodes() {
            const newCodes = document.getElementById('newCodesInput').value.split('\n');
            newCodes.forEach(code => {
                code = code.trim();
                if (code) {
                    codes.push(code);
                }
            });
            saveCodes();
            renderCodes();
            document.getElementById('newCodesInput').value = '';
        }

        // Очистка всех кодов
        function clearCodes() {
            codes = [];
            saveCodes();
            renderCodes();
        }

        // Обработка клика по коду
        function handleCodeClick(code, index) {
            copyToClipboard(code);
            codes.splice(index, 1);  // Удаление кода из массива
            saveCodes();  // Сохранение обновленного массива
            renderCodes();  // Перерисовка кодов
            openTelegramBot();  // Открытие Telegram-бота
        }

        // Копирование текста в буфер обмена
        function copyToClipboard(text) {
            const tempInput = document.createElement("input");
            tempInput.style.position = "absolute";
            tempInput.style.left = "-9999px";
            tempInput.value = text;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);
        }

        // Открытие Telegram-бота
        function openTelegramBot() {
            window.open('https://t.me/hamsTer_kombat_bot/start', '_blank');
            window.close();
        }

        // Отправка тестового уведомления
        function sendNotification() {
            if (codes.length === 0 || !notificationsEnabled || sentNotifications >= notificationLimit) return;

            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.ready.then(registration => {
                    registration.showNotification('Забери код', {
                        body: 'Нажмите, чтобы получить ваш код',
                        icon: 'https://cahhek.github.io/weef323423f/unnamed.jpg',
                        data: {
                            url: 'https://cahhek.github.io/weef323423f/'  // URL главной страницы
                        }
                    });
                    sentNotifications++; // Увеличение счетчика отправленных уведомлений
                });
            }
        }

        // Генерация случайного интервала уведомлений
        function getRandomInterval() {
            const min = 45 * 60 * 1000; // 45 минут
            const max = 90 * 60 * 1000; // 90 минут
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // Включение уведомлений
        function enableNotifications(duration) {
            notificationsEnabled = true;
            sentNotifications = 0; // Сброс счетчика отправленных уведомлений

            function scheduleNextNotification() {
                const interval = getRandomInterval();
                notificationTimeout = setTimeout(() => {
                    sendNotification();
                    if (notificationsEnabled && sentNotifications < notificationLimit) {
                        scheduleNextNotification();
                    }
                }, interval);
            }

            scheduleNextNotification();

            let delay;
            switch (duration) {
                case '1h':
                    delay = 60 * 60 * 1000; // 1 час
                    break;
                case '6h':
                    delay = 6 * 60 * 1000; // 6 часов
                    break;
                case 'always':
                    delay = Infinity; // Бесконечно
                    break;
            }

            if (duration !== 'always') {
                setTimeout(disableNotifications, delay); // Выключение уведомлений через указанный интервал
            }
        }

        // Выключение уведомлений
        function disableNotifications() {
            notificationsEnabled = false;
            clearTimeout(notificationTimeout);
            console.log('Уведомления выключены');
        }

        // Загрузка и отображение кодов при загрузке страницы
        loadCodes();
        renderCodes();
    </script>
</body>
</html>
