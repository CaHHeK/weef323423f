<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Push Notifications</title>
    <style>
       .code {
            cursor: pointer;
            padding: 10px;
            margin: 5px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            display: inline-block;
            width: calc(50% - 20px); /* Два кода в ряд */
            box-sizing: border-box;
            white-space: pre-wrap; /* Сохраняет переносы строк */
        }
        #codesContainer {
            display: flex;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div id="codesContainer"></div>
    <textarea id="newCodesInput" placeholder="Enter new codes, one per line" rows="5" cols="30"></textarea>
    <br>
    <button onclick="addNewCodes()">Add Codes</button>
    <button onclick="clearCodes()">Clear Codes</button>
    <button onclick="sendNotification()">Test Notification</button>

    <script>
        const storageKey = 'savedCodes';
        let codes = [];

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/weef323423f/sw.js').then(reg => {
                console.log('Service Worker registered:', reg);
            }).catch(err => {
                console.error('Service Worker registration failed:', err);
            });
        }

        function loadCodes() {
            const savedCodes = localStorage.getItem(storageKey);
            if (savedCodes) {
                codes = JSON.parse(savedCodes);
            }
        }

        function saveCodes() {
            localStorage.setItem(storageKey, JSON.stringify(codes));
        }

        function renderCodes() {
            const container = document.getElementById('codesContainer');
            container.innerHTML = '';
            codes.forEach((code, index) => {
                const codeDiv = document.createElement('div');
                codeDiv.className = 'code';
                codeDiv.innerText = code;
                codeDiv.onclick = () => copyToClipboard(code, index);
                container.appendChild(codeDiv);
            });
        }

        function addNewCodes() {
            const newCodes = document.getElementById('newCodesInput').value.split('\n');
            newCodes.forEach(code => {
                code = code.trim();
                if (code) {
                    codes.push(code);
                }
            });
            saveCodes();
            renderCodes();
            document.getElementById('newCodesInput').value = '';
        }

        function clearCodes() {
            codes = [];
            saveCodes();
            renderCodes();
        }

        function copyToClipboard(text, index) {
            const tempInput = document.createElement("input");
            tempInput.style.position = "absolute";
            tempInput.style.left = "-9999px";
            tempInput.value = text;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);

            codes.splice(index, 1);
            saveCodes();
            renderCodes();
        }

        function sendNotification() {
            if (codes.length === 0) return;

            const randomCode = codes[Math.floor(Math.random() * codes.length)];

            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.ready.then(registration => {
                    registration.showNotification('Reminder!', {
                        body: `Your code: ${randomCode}`,
                        icon: 'https://cahhek.github.io/weef323423f/unnamed.jpg',
                        data: {
                            url: 'https://example.com' // Ссылка на страницу с кодами
                        }
                    });
                });
            }
        }

        function scheduleNextNotification() {
            const min = 15 * 1000; // 15 секунд
            const max = 30 * 1000; // 30 секунд
            const timeout = Math.floor(Math.random() * (max - min + 1)) + min;

            setTimeout(() => {
                sendNotification();
                scheduleNextNotification();
            }, timeout);
        }

        if ("Notification" in window) {
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    scheduleNextNotification();
                }
            });
        }

        loadCodes();
        renderCodes();
    </script>

</body>
</html>
